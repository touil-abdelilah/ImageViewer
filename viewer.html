<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Image Viewer & OCR Tool</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    #canvas-container { border: 2px dashed #ccc; padding: 10px; display: inline-block; position: relative; overflow: hidden; max-width: 90vw; max-height: 80vh; background: #f9f9f9; }
    canvas { cursor: grab; }
    #controls { margin: 15px; }
    button { margin: 5px; padding: 10px 15px; font-size: 14px; }
    #ocr-result { margin-top: 20px; white-space: pre-wrap; text-align: left; max-width: 90vw; margin-left: auto; margin-right: auto; background: #f0f0f0; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>🖼️ Bank Transfer Image Viewer + OCR</h2>
  <div id="canvas-container" ondrop="handleDrop(event)" ondragover="event.preventDefault()">
    <canvas id="canvas" width="800" height="600"></canvas>
  </div>
  <div id="controls">
    <button onclick="rotate(-90)">Rotate Left ⬅️</button>
    <button onclick="rotate(90)">Rotate Right ➡️</button>
    <button onclick="zoom(1.1)">Zoom In 🔍</button>
    <button onclick="zoom(0.9)">Zoom Out 🔎</button>
    <button onclick="extractText()">Extract Text 🧠</button>
  </div>
  <div id="ocr-result"></div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let img = new Image();
    let rotation = 0;
    let scale = 1;
    let posX = 0, posY = 0, isDragging = false, dragStart = {};

    canvas.onmousedown = e => {
      isDragging = true;
      dragStart = { x: e.offsetX - posX, y: e.offsetY - posY };
      canvas.style.cursor = "grabbing";
    };
    canvas.onmouseup = () => {
      isDragging = false;
      canvas.style.cursor = "grab";
    };
    canvas.onmousemove = e => {
      if (isDragging) {
        posX = e.offsetX - dragStart.x;
        posY = e.offsetY - dragStart.y;
        render();
      }
    };

    function handleDrop(event) {
      event.preventDefault();
      const file = event.dataTransfer.files[0];
      if (file && file.type.startsWith("image")) {
        const reader = new FileReader();
        reader.onload = e => {
          img.onload = () => {
            rotation = 0;
            scale = 1;
            posX = 0;
            posY = 0;
            render();
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }

    function rotate(deg) {
      rotation = (rotation + deg) % 360;
      render();
    }

    function zoom(factor) {
      scale *= factor;
      render();
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(canvas.width / 2 + posX, canvas.height / 2 + posY);
      ctx.rotate(rotation * Math.PI / 180);
      ctx.scale(scale, scale);
      ctx.drawImage(img, -img.width / 2, -img.height / 2);
      ctx.restore();
    }

    async function extractText() {
      if (!img.src) return;
      document.getElementById("ocr-result").innerText = "Reading text... Please wait ⏳";
      const result = await Tesseract.recognize(img.src, "eng", {
        logger: m => console.log(m)
      });
      document.getElementById("ocr-result").innerText = result.data.text.trim() || "No readable text found.";
    }
  </script>
</body>
</html>
